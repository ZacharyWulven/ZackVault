---
layout: post
title: ReactGuide-02
date: 2023-11-05 16:45:30.000000000 +09:00
categories: [Web, React, å…¥é—¨]
tags: [Web, React]
---


# React ä¸­çš„äº‹ä»¶å¤„ç†
* é€šè¿‡ `onXxx` å±æ€§æŒ‡å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰
  * React ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ï¼ˆåˆæˆï¼‰äº‹ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çš„åŸç”Ÿ `DOM` äº‹ä»¶
  * React ä¸­çš„äº‹ä»¶æ˜¯é€šè¿‡äº‹ä»¶å§”æ‰˜æ–¹å¼å¤„ç†çš„ï¼ˆå§”æ‰˜ç»™äº†ç»„ä»¶æœ€å¤–å±‚çš„å…ƒç´ ï¼‰ï¼Œä¸ºäº†é«˜æ•ˆ
    * ä¾‹å¦‚ï¼š`div` åŒ…ç€ `input`ï¼Œåœ¨ `input` ä¸ŠåŠ äº‹ä»¶ï¼Œå…¶å®æ˜¯å§”æ‰˜ç»™ `div`
* é€šè¿‡ `event.target` å¾—åˆ°å‘ç”Ÿäº‹ä»¶çš„ `DOM` å…ƒç´ å¯¹è±¡
  * ä¸è¦è¿‡æ¸¡ä½¿ç”¨ `Ref`ï¼Œå¦‚æœå‘ç”Ÿäº‹ä»¶çš„ `Ref` æ­£å¥½æ˜¯ä½ è¦æ“ä½œçš„ `Ref`ï¼Œè¿™æ—¶è¿™ä¸ª `Ref` å¯ä»¥çœç•¥ï¼Œå¯é€šè¿‡ `event.target` è·å–
  * ä¾‹å¦‚ä¸‹è¾¹çš„ `showData2`
  
  
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Demo extends React.Component {
        /*
          React.createRef è°ƒç”¨åå¯ä»¥è¿”å›ä¸€ä¸ªå®¹å™¨ï¼Œè¯¥å®¹å™¨å¯å­˜å‚¨è¢« ref æ‰€æ ‡è¯†çš„èŠ‚ç‚¹
          è¯¥å®¹å™¨æ˜¯â€œä¸“äººä¸“ç”¨â€çš„
        */
        myRef = React.createRef();

        myRef2 = React.createRef();

        render() {
          return (
            <div>
              <input
                ref={this.myRef}
                type="text"
                placeholder="ç‚¹å‡»æŒ‰é’®æç¤ºæ•°æ®"
              />
              <button onClick={this.showData}>ç‚¹å‡»æŒ‰é’®æç¤ºæ•°æ®</button>
              <input
                onBlur={this.showData2}
                type="text"
                placeholder="å¤±å»ç„¦ç‚¹æç¤ºæ•°æ®"
              />
            </div>
          );
        }
        // å±•ç¤ºå·¦ä¾§è¾“å…¥æ¡†çš„æ•°æ®
        showData = () => {
          console.log(this.myRef);
          alert(this.myRef.current.value);
        };

        showData2 = (event) => {
          //   alert(this.myRef2.current.value);
          alert(event.target.value);
        };
      }
      ReactDOM.render(<Demo />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# éå—æ§ç»„ä»¶
* éå—æ§ç»„ä»¶ï¼šå³é¡µé¢ä¸­æ‰€æœ‰è¾“å…¥ç±»çš„ DOM ç»„ä»¶ï¼Œ`é€‰ç”¨é€‰å–çš„`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Login extends React.Component {
        handleSubmit = (event) => {
          event.preventDefault(); // é˜»æ­¢è¡¨å•æäº¤
          const { username, password } = this;
          alert(`è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username.value}ï¼Œå¯†ç æ˜¯ï¼š${password.value}`);
        };

        render() {
          return (
            /*
                action çš„ url æ˜¯æäº¤é¡µé¢ï¼Œé»˜è®¤ä¸º Get è¯·æ±‚
                input ä¸­çš„ name="username"ï¼Œä¼šä½œä¸º Get è¯·æ±‚çš„ query
             */
            <form action="http://www.xxx.com" onSubmit={this.handleSubmit}>
              ç”¨æˆ·åï¼š
              <input
                ref={(c) => (this.username = c)}
                type="text"
                name="username"
              />
              å¯†ç ï¼š
              <input
                ref={(c) => (this.password = c)}
                type="password"
                name="password"
              />
              <button>ç™»å½•</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# å—æ§ç»„ä»¶
* å—æ§ç»„ä»¶ï¼šé¡µé¢ä¸­æ‰€æœ‰è¾“å…¥ç±» DOMï¼Œéšç€ä½ çš„è¾“å…¥æŠŠæ•°æ®ç»´æŠ¤åˆ° `state` ä¸­ï¼Œç­‰éœ€è¦ç”¨çš„æ—¶å€™ç›´æ¥ä» `state` ä¸­å–


```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Login extends React.Component {
        state = {
          username: "",
          password: "",
        };

        // è¡¨å•å›è°ƒ
        handleSubmit = (event) => {
          event.preventDefault(); // é˜»æ­¢è¡¨å•æäº¤
          const { username, password } = this.state;
          alert(`è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username}ï¼Œå¯†ç æ˜¯ï¼š${password}`);
        };

        // ä¿å­˜ç”¨æˆ·ååˆ°çŠ¶æ€ä¸­
        saveUsername = (event) => {
          console.log(event.target.value);
          this.setState({ username: event.target.value });
        };

        // ä¿å­˜å¯†ç åˆ°çŠ¶æ€ä¸­
        savePassword = (event) => {
          this.setState({ password: event.target.value });
        };

        render() {
          return (
            /*
                action çš„ url æ˜¯æäº¤é¡µé¢ï¼Œé»˜è®¤ä¸º Get è¯·æ±‚
                input ä¸­çš„ name="username"ï¼Œä¼šä½œä¸º Get è¯·æ±‚çš„ query
             */
            <form action="http://www.xxx.com" onSubmit={this.handleSubmit}>
              ç”¨æˆ·åï¼š
              <input onChange={this.saveUsername} type="text" name="username" />
              å¯†ç ï¼š
              <input
                onChange={this.savePassword}
                type="password"
                name="password"
              />
              <button>ç™»å½•</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

> å»ºè®®å¤šä½¿ç”¨å—æ§ç»„ä»¶ï¼Œå› ä¸ºè¿™ä¼šé˜²æ­¢ `Ref` çš„è¿‡åº¦ä½¿ç”¨
{: .prompt-info }


# é€šè¿‡é«˜é˜¶å‡½æ•°æŸ¯é‡ŒåŒ–å®ç°åˆå¹¶ä¸Šä¾‹ç”¨æˆ·åå’Œå¯†ç 

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      //#region
      /*
        é«˜é˜¶å‡½æ•°ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°ç¬¦åˆä¸‹é¢2ä¸ªè§„èŒƒä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œé‚£è¯¥å‡½æ•°å°±æ˜¯é«˜é˜¶å‡½æ•°
        1. è‹¥ A å‡½æ•°ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆ A å°±å¯ä»¥ç§°ä¸ºé«˜é˜¶å‡½æ•°
        2. è‹¥ A å‡½æ•°ï¼Œè°ƒç”¨çš„è¿”å›å€¼ä¾ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆ A å°±å¯ä»¥ç§°ä¸ºé«˜é˜¶å‡½æ•°
        å¸¸è§çš„é«˜é˜¶å‡½æ•°ï¼šPromiseã€setTimeoutã€arr.map() ç­‰ç­‰
      */
      //#endregion

      class Login extends React.Component {
        state = {
          username: "",
          password: "",
        };

        // è¡¨å•å›è°ƒ
        handleSubmit = (event) => {
          event.preventDefault(); // é˜»æ­¢è¡¨å•æäº¤
          const { username, password } = this.state;
          alert(`è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username}ï¼Œå¯†ç æ˜¯ï¼š${password}`);
        };

        // åˆå¹¶ saveUsername å’Œ savePassword ä¸º saveFormData

        saveFormData = (dataType) => {
          console.log("$", dataType);
          // è¿™ä¸ªå‡½æ•°æ‰æ˜¯çœŸæ­£ onChange çš„å›è°ƒ
          return (event) => {
            /*
                let a = "name";
                let obj = {};
                obj.name = "tom";
                obj[a] = "tom";   å– name å±æ€§
                console.log(obj);
                è¿™é‡Œ  ç”¨ [] å– dataType å±æ€§
            */
            this.setState({ [dataType]: event.target.value });
            console.log("@", dataType, event.target.value);
          };
        };
        render() {
          return (
            <form onSubmit={this.handleSubmit}>
              ç”¨æˆ·åï¼š
              <input
                // å°† saveFormData è¿”å›çš„å‡½æ•°èµ‹å€¼ç»™ onChange
                onChange={this.saveFormData("username")}
                type="text"
                name="username"
              />
              å¯†ç ï¼š
              <input
                onChange={this.saveFormData("password")}
                type="password"
                name="password"
              />
              <button>ç™»å½•</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# ä¸ä½¿ç”¨å‡½æ•°æŸ¯é‡ŒåŒ–å®ç°åˆå¹¶ä¸Šä¾‹ç”¨æˆ·åå’Œå¯†ç 

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Login extends React.Component {
        state = {
          username: "",
          password: "",
        };

        // è¡¨å•å›è°ƒ
        handleSubmit = (event) => {
          event.preventDefault(); // é˜»æ­¢è¡¨å•æäº¤
          const { username, password } = this.state;
          alert(`è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username}ï¼Œå¯†ç æ˜¯ï¼š${password}`);
        };

        // åˆå¹¶ saveUsername å’Œ savePassword ä¸º saveFormData

        saveFormData = (dataType, event) => {
          console.log("$", dataType);
          this.setState({ [dataType]: event.target.value });
        };
        render() {
          return (
            <form onSubmit={this.handleSubmit}>
              ç”¨æˆ·åï¼š
              <input
                // ä½¿ç”¨ (event) => { ... } èµ‹å€¼ç»™ onChange
                onChange={(event) => {
                  this.saveFormData("username", event);
                }}
                type="text"
                name="username"
              />
              å¯†ç ï¼š
              <input
                onChange={(event) => {
                  this.saveFormData("password", event);
                }}
                type="password"
                name="password"
              />
              <button>ç™»å½•</button>
            </form>
          );
        }
      }
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

# React ç»„ä»¶çš„å£°æ˜å‘¨æœŸ
* æŒ‚è½½ï¼ˆmountï¼‰ï¼šç»„ä»¶æ”¾åˆ°é¡µé¢
* å¸è½½ï¼ˆunmountï¼‰ï¼šå°†é¡µé¢å¹²æ‰


```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>hello react</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Life extends React.Component {
        state = { opacity: 1 };

        handle = () => {
          // å¸è½½ç»„ä»¶
          ReactDOM.unmountComponentAtNode(document.getElementById("test"));
        };

        // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆå›è°ƒï¼‰å‡½æ•°ï¼Œæˆ–å«ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°
        // ç»„ä»¶æŒ‚è½½å®Œæ¯•å
        componentDidMount() {
          this.timer = setInterval(() => {
            // è·å–åŸçŠ¶æ€
            let { opacity } = this.state;
            // å‡å° 0.1
            opacity -= 0.1;
            if (opacity <= 0) opacity = 1;
            // è®¾ç½®æ–°çš„é€æ˜åº¦
            this.setState({ opacity }); // ç®€å†™
            // this.setState({ opacity: opacity }); // ç®€å†™
            console.log("@");
          }, 200);
        }

        // ç»„ä»¶å°†è¦å¸è½½
        componentWillUnmount() {
          // æ¸…é™¤å®šæ—¶å™¨
          clearInterval(this.timer);
        }

        // render è°ƒç”¨çš„æ—¶æœºï¼šåˆå§‹åŒ–æ¸²æŸ“ã€çŠ¶æ€æ›´æ–°ä¹‹å
        render() {
          return (
            <div>
              <h2 style={{ opacity: this.state.opacity }}>
                React å­¦ä¸ä¼šæ€ä¹ˆåŠï¼Ÿ
              </h2>
              <button onClick={this.handle}>å‡‰æ‹Œ</button>
            </div>
          );
        }
      }
      ReactDOM.render(<Life />, document.getElementById("test"));
    </script>
  </body>
</html>
```

## ç”Ÿå‘½å‘¨æœŸï¼ˆæ—§ï¼‰

![image](/assets/images/react/guide/life_cycle.png)

### åˆå§‹åŒ–é˜¶æ®µï¼šç”± `ReactDOM.render()` è§¦å‘----åˆæ¬¡æ¸²æŸ“
1. `constructor`
2. `componentWillMount`
3. `render`            ====> `å¿…é¡»è¦ç”¨`
4. `componentDidMount` ====> `å¸¸ç”¨`
  * ä¸€èˆ¬åœ¨è¿™ä¸ªé’©å­å†…åšä¸€äº›åˆå§‹åŒ–çš„äº‹ï¼Œä¾‹å¦‚ï¼šå¼€å¯å®šæ—¶å™¨ã€å‘é€ç½‘ç»œè¯·æ±‚ã€è®¢é˜…æ¶ˆæ¯


### æ›´æ–°é˜¶æ®µï¼šç”±ç»„ä»¶å†… `this.setState()` æˆ–çˆ¶ç»„ä»¶é‡æ–° `render` è§¦å‘ï¼š
1. ä¼šè°ƒç”¨ `shouldComponentUpdate`ï¼Œå¹¶æ£€æŸ¥è¿”å›å€¼
  * å¦‚æœè¿”å› `true`ï¼Œåˆ™æ›´æ–°ç»„ä»¶ï¼Œéšåä¾æ¬¡è°ƒç”¨ `componentWillUpdate`ã€`render`ã€`componentDidUpdate`
  * å¦‚æœè¿”å› `false`ï¼Œåˆ™ä¸è§¦å‘ä»»ä½•æ›´æ–°


2. è°ƒç”¨ `forceUpdate()` åï¼ˆç”¨äºä¸æƒ³ä¿®æ”¹ stateï¼Œåªå¼ºåˆ¶æ›´æ–°ç»„ä»¶åœºæ™¯ï¼‰ï¼šéšåä¾æ¬¡è°ƒç”¨ `componentWillUpdate`ã€`render`ã€`componentDidUpdate`
  * æœ¬æ–¹æ³•ä¸å— `shouldComponentUpdate` è¿”å›å€¼çš„æ§åˆ¶
  
3. å¦‚æœæ¶‰åŠçˆ¶å­æ›´æ–°æƒ…å†µï¼š
  * å…ˆè°ƒç”¨ `componentWillReceiveProps`ï¼ˆç»„ä»¶å°†è¦æ¥æ”¶æ–°çš„ props é’©å­ï¼Œè¿™ä¸ªé’©å­ç¬¬ä¸€æ¬¡ä¸ä¼šè°ƒç”¨ï¼‰
  * éšåå°†æŸ¥çœ‹ `shouldComponentUpdate`ï¼Œå¹¶æ£€æŸ¥è¿”å›å€¼ï¼Œå†³å®šæ˜¯å¦ç»§ç»­å¾€ä¸‹è°ƒç”¨
  

### å¸è½½é˜¶æ®µï¼šç”± `ReactDOM.unmountComponentAtNode(document.getElementById("xx"))` è§¦å‘
* å¸è½½å‰è°ƒç”¨ `componentWillUnmount` ====> `å¸¸ç”¨`
  * ä¸€èˆ¬åœ¨è¿™ä¸ªé’©å­å†…åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚ï¼šå…³é—­å®šæ—¶å™¨ã€å–æ¶ˆè®¢é˜…æ¶ˆæ¯
  
  
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>æ±‚å’ŒåŠŸèƒ½</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      // A æ˜¯çˆ¶ç»„ä»¶ï¼ŒB æ˜¯å­ç»„ä»¶
      class A extends React.Component {
        state = { carName: "å¥”é©°" };

        changeCar = () => {
          this.setState({ carName: "æ³•æ‹‰åˆ©" });
        };

        render() {
          return (
            <div>
              æˆ‘æ˜¯ A ç»„ä»¶
              <button onClick={this.changeCar}>æ¢è½¦</button>
              // ä¼ å…¥æ ‡ç­¾å‚æ•°
              <B carName={this.state.carName} />
            </div>
          );
        }
      }

      class B extends React.Component {
        componentDidMount() {
          console.log("B----componentDidMount");
        }
        // ç»„ä»¶å°†è¦æ¥æ”¶æ–°çš„ props é’©å­ï¼Œè¿™ä¸ªé’©å­ç¬¬ä¸€æ¬¡ä¸ä¼šè°ƒç”¨
        componentWillReceiveProps(props) {
          console.log("B----componentWillReceiveProps", props);
        }

        shouldComponentUpdate() {
          console.log("B-shouldComponentUpdate");

          return true;
        }

        componentDidUpdate() {
          console.log("B-componentDidUpdate");
        }

        componentWillUpdate() {
          console.log("B-componentWillUpdate");
        }
        render() {
          console.log("B----render");
          return <div>æˆ‘æ˜¯ B ç»„ä»¶ï¼Œæ¥æ”¶åˆ°è½¦æ˜¯ï¼š{this.props.carName}</div>;
        }
      }

      class Counter extends React.Component {
        constructor(props) {
          console.log("Counter-constructor");
          super(props);

          // åˆå§‹åŒ–çŠ¶æ€
          this.state = { sum: 0 };
        }

        add = () => {
          let { sum } = this.state;
          sum += 1;
          this.setState({ sum });
        };

        dead = () => {
          ReactDOM.unmountComponentAtNode(document.getElementById("test"));
        };

        compel = () => {
          this.forceUpdate();
          console.log("Counter-forceUpdate");
        };

        // ç»„ä»¶æŒ‚è½½å®Œæ¯•å
        componentDidMount() {
          console.log("Counter-componentDidMount");
        }

        // ç»„ä»¶å°†è¦å¸è½½
        componentWillUnmount() {
          console.log("Counter-componentWillUnmount");
        }

        // ç»„ä»¶å°†è¦æŒ‚è½½
        componentWillMount() {
          console.log("Counter-componentWillMount");
        }

        //
        shouldComponentUpdate() {
          console.log("Counter-shouldComponentUpdate");
          return true;
        }

        componentDidUpdate() {
          console.log("Counter-componentDidUpdate");
        }

        componentWillUpdate() {
          console.log("Counter-componentWillUpdate");
        }

        // render è°ƒç”¨çš„æ—¶æœºï¼šåˆå§‹åŒ–æ¸²æŸ“ã€çŠ¶æ€æ›´æ–°ä¹‹å
        render() {
          console.log("Counter-render");

          const { sum } = this.state;
          return (
            <div>
              <h2>å½“å‰æ±‚å’Œä¸ºï¼š{sum}</h2>
              <button onClick={this.add}>ç‚¹æˆ‘+1</button>
              <button onClick={this.dead}>ç‚¹æˆ‘å¸è½½</button>
              <button onClick={this.compel}>
                ä¸æ›´æ”¹çŠ¶æ€ä¸­çš„æ•°æ®ï¼Œå¼ºåˆ¶æ›´æ–°{" "}
              </button>
            </div>
          );
        }
      }
      //   ReactDOM.render(<Counter />, document.getElementById("test"));

      ReactDOM.render(<A />, document.getElementById("test"));
    </script>
  </body>
</html>
```



## ç”Ÿå‘½å‘¨æœŸï¼ˆæ–°ï¼‰

[å‰ç«¯å¼€å‘åº“æŸ¥æ‰¾](https://www.bootcdn.cn/)

### æ–°çš„ç”Ÿå‘½å‘¨æœŸå³å°† `Deprecated` 3 ä¸ªé’©å­
1. `componentWillUpdate` æ”¹æˆ `UNSAFE_componentWillUpdate`ï¼Œå¦åˆ™è­¦å‘Š
2. `componentWillMount` æ”¹æˆ `UNSAFE_componentWillMount`ï¼Œå¦åˆ™è­¦å‘Š
3. `componentWillReceiveProps` æ”¹æˆ `UNSAFE_componentWillReceiveProps`ï¼Œå¦åˆ™è­¦å‘Š


* ä¸ºä»€ä¹ˆä¸Šè¾¹ä¸‰ä¸ªé’©å­ `Deprecated`ï¼Ÿ
  * è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç»å¸¸è¢«è¯¯è§£å’Œæ»¥ç”¨ï¼›æ­¤å¤–ï¼Œæˆ‘ä»¬é¢„è®¡ï¼Œåœ¨å¼‚æ­¥æ¸²æŸ“ä¸­ï¼Œå®ƒä»¬æ½œåœ¨çš„è¯¯ç”¨é—®é¢˜å¯èƒ½æ›´å¤§ã€‚æˆ‘ä»¬å°†åœ¨å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­ä¸ºè¿™äº›ç”Ÿå‘½å‘¨æœŸæ·»åŠ  `UNSAFE_` å‰ç¼€ã€‚ï¼ˆè¿™é‡Œçš„ `unsafeâ€` ä¸æ˜¯æŒ‡å®‰å…¨æ€§ï¼Œè€Œæ˜¯è¡¨ç¤ºä½¿ç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ä»£ç åœ¨ React çš„æœªæ¥ç‰ˆæœ¬ä¸­æ›´æœ‰å¯èƒ½å‡ºç° `bug`ï¼Œå°¤å…¶æ˜¯åœ¨å¯ç”¨å¼‚æ­¥æ¸²æŸ“ä¹‹åã€‚
  * [å®˜æ–¹è§£é‡Š](https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html)
* å…¶å®ä¸Šè¾¹ä¸‰ä¸ªæ–¹æ³•ï¼Œå¼€å‘ä¸­ç”¨çš„å¾ˆå°‘


### æ–°çš„ç”Ÿå‘½å‘¨æœŸæå‡ºä¸¤ä¸ªæ–°é’©å­ `getDerivedStateFromProps` å’Œ `getSnapshotBeforeUpdate`
* ä½†è¿™ä¸¤ä¸ªæ–°åŠ çš„ä¸å¸¸ç”¨ ğŸ¤£


![image](/assets/images/react/guide/life_cycle_new.png)


### `getDerivedStateFromProps` 
* ä½¿ç”¨æ¦‚ç‡æä½ï¼Œä½¿ç”¨åœºæ™¯ç½•è§ï¼ˆäº†è§£å³å¯ï¼‰
* æ­¤æ–¹æ³•æ¨ªè·¨åˆå§‹åŒ–é˜¶æ®µå’Œæ›´æ–°é˜¶æ®µ

```javascript
        /*
            å¿…é¡»å®šä¹‰ä¸º static
            å¿…é¡»è¿”å›ä¸‹è¾¹ä¸¤ä¸ªä¸­çš„ä¸€ä¸ªï¼š
                1. çŠ¶æ€å¯¹è±¡
                2. null
            ä¸€æ—¦å®šä¹‰ getDerivedStateFromPropsï¼Œ è‡ªå®šä¹‰çš„ state ä¼šå¤±æ•ˆ
            æ­¤æ–¹æ³•ç”¨äº state çš„å€¼åœ¨ä»»ä½•æ—¶å€™éƒ½å–å†³äº propsï¼Œ
            æ´¾ç”ŸçŠ¶æ€ä¼šå¯¼è‡´ä»£ç å†—ä½™ï¼Œå¹¶ä½¿ç»„ä»¶éš¾ä»¥ç»´æŠ¤
        */
        static getDerivedStateFromProps(props, state) {
          console.log("Counter-getDerivedStateFromProps:", props, state);
          //   return null;
          //   return { sum: 108 };
          return props;
        }
```

> æ­¤æ–¹æ³•ç”¨äº `state` çš„å€¼åœ¨ä»»ä½•æ—¶å€™éƒ½å–å†³äº `props` æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œä½†ä¸æ˜¯å¿…é¡»ç”¨ã€‚å…¶ä»–è§£å†³æ€è·¯ï¼šä¹Ÿå¯ä»¥åœ¨æ„é€ å™¨ä¸­å¯¹ `props` è¿›è¡Œå¤„ç†å­˜æ”¾åˆ° `state` ä¸­ã€‚æ‰€ä»¥æ­¤æ–¹æ³•å­˜åœ¨æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚
{: .prompt-info }


### æ›´æ–°é˜¶æ®µçš„ï¼š`getSnapshotBeforeUpdate` 
* ä½¿ç”¨æ¦‚ç‡ä½


```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ç”Ÿå‘½å‘¨æœŸ-æ–°</title>
    <style>
      .list {
        width: 200px;
        height: 150px;
        background-color: skyblue;
        overflow: auto;
      }
      .news {
        height: 30px;
      }
    </style>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class NewsList extends React.Component {
        state = { newsArr: [] };

        componentDidMount() {
          setInterval(() => {
            // è·å–åŸçŠ¶æ€
            const { newsArr } = this.state;
            // æ¨¡æ‹Ÿä¸€æ¡æ–°é—»
            const news = "æ–°é—»" + (newsArr.length + 1);
            // æ›´æ–°çŠ¶æ€ï¼Œå°†æœ€æ–° news æ”¾åˆ°æœ€å‰è¾¹
            this.setState({ newsArr: [news, ...newsArr] });
          }, 1000);
        }

        /*
            ä»»ä½•å€¼éƒ½å¯ä»¥ä½œä¸ºå¿«ç…§å€¼
            åœ¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“è¾“å‡ºï¼ˆæäº¤åˆ° DOM èŠ‚ç‚¹ï¼‰ä¹‹å‰è°ƒç”¨ï¼Œ
            å®ƒä½¿å¾—ç»„ä»¶èƒ½åœ¨å‘ç”Ÿæ›´æ”¹ä¹‹å‰ä» DOM ä¸­æ•è·ä¸€äº›ä¿¡æ¯
            æ­¤æ–¹æ³•çš„ä»»ä½•è¿”å›å€¼å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™ componentDidUpdate

            æ­¤æ–¹æ³•å°±ç›¸å½“äº componentWillUpdate
         */
        getSnapshotBeforeUpdate() {
          console.log("NewsList-getSnapshotBeforeUpdate:");
          return this.refs.list.scrollHeight;
        }

        componentDidUpdate(prevProps, prevState, height) {
          this.refs.list.scrollTop += this.refs.list.scrollHeight - height;
        }

        // render è°ƒç”¨çš„æ—¶æœºï¼šåˆå§‹åŒ–æ¸²æŸ“ã€çŠ¶æ€æ›´æ–°ä¹‹å
        render() {
          console.log("NewsList-render");

          return (
            <div className="list" ref="list">
              {this.state.newsArr.map((n, index) => {
                return (
                  // è®¾ç½® key å¦åˆ™ä¼šæœ‰é”™è¯¯
                  <div key={index} className="news">
                    {n}
                  </div>
                );
              })}
            </div>
          );
        }
      }
      ReactDOM.render(<NewsList />, document.getElementById("test"));
    </script>
  </body>
</html>
```

## ## ç”Ÿå‘½å‘¨æœŸï¼ˆæ–°ï¼‰æ€»ç»“

### åˆå§‹åŒ–é˜¶æ®µï¼šç”± `ReactDOM.render()` è§¦å‘----åˆæ¬¡æ¸²æŸ“
1. `constructor`
2. `getDerivedStateFromProps` ====> `ä½¿ç”¨æ¦‚ç‡æä½`
3. `render`            ====> `å¿…é¡»è¦ç”¨`
4. `componentDidMount` ====> `å¸¸ç”¨`
  * ä¸€èˆ¬åœ¨è¿™ä¸ªé’©å­å†…åšä¸€äº›åˆå§‹åŒ–çš„äº‹ï¼Œä¾‹å¦‚ï¼šå¼€å¯å®šæ—¶å™¨ã€å‘é€ç½‘ç»œè¯·æ±‚ã€è®¢é˜…æ¶ˆæ¯


### æ›´æ–°é˜¶æ®µï¼šç”±ç»„ä»¶å†… `this.setState()` æˆ–çˆ¶ç»„ä»¶é‡æ–° `render` è§¦å‘ï¼š
1. `getDerivedStateFromProps` ====> `ä½¿ç”¨æ¦‚ç‡æä½`
2. ä¼šè°ƒç”¨ `shouldComponentUpdate`ï¼Œå¹¶æ£€æŸ¥è¿”å›å€¼
  * å¦‚æœè¿”å› `true`ï¼Œåˆ™æ›´æ–°ç»„ä»¶ï¼Œéšåä¾æ¬¡è°ƒç”¨ `getSnapshotBeforeUpdate`ã€`render`ã€`componentDidUpdate`
  * å¦‚æœè¿”å› `false`ï¼Œåˆ™ä¸è§¦å‘ä»»ä½•æ›´æ–°

3. è°ƒç”¨ `forceUpdate()` åï¼ˆç”¨äºä¸æƒ³ä¿®æ”¹ stateï¼Œåªå¼ºåˆ¶æ›´æ–°ç»„ä»¶åœºæ™¯ï¼‰ï¼šéšåä¾æ¬¡è°ƒç”¨ `getSnapshotBeforeUpdate`ã€`render`ã€`componentDidUpdate`
  * æœ¬æ–¹æ³•ä¸å— `shouldComponentUpdate` è¿”å›å€¼çš„æ§åˆ¶
  
4. å¦‚æœæ¶‰åŠçˆ¶å­æ›´æ–°æƒ…å†µï¼šç”±äº `componentWillReceiveProps` å³å°†åºŸå¼ƒï¼Œæ­¤æƒ…å†µå‚è€ƒè°ƒç”¨ `shouldComponentUpdate` åçš„æµç¨‹
  
### å¸è½½é˜¶æ®µï¼šç”± `ReactDOM.unmountComponentAtNode(document.getElementById("xx"))` è§¦å‘
* å¸è½½å‰è°ƒç”¨ `componentWillUnmount` ====> `å¸¸ç”¨`
  * ä¸€èˆ¬åœ¨è¿™ä¸ªé’©å­å†…åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚ï¼šå…³é—­å®šæ—¶å™¨ã€å–æ¶ˆè®¢é˜…æ¶ˆæ¯
  

# DOM çš„ Diffing ç®—æ³•

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ç”Ÿå‘½å‘¨æœŸ-æ–°</title>
    <style>
      .list {
        width: 200px;
        height: 150px;
        background-color: skyblue;
        overflow: auto;
      }
      .news {
        height: 30px;
      }
    </style>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      class Time extends React.Component {
        state = { date: new Date() };

        componentDidMount() {
          // æ¯éš” 1 ç§’æ›´æ–°ä¸€ä¸‹çŠ¶æ€
          setInterval(() => {
            this.setState({ date: new Date() });
          }, 1000);
        }

        // render è°ƒç”¨çš„æ—¶æœºï¼šåˆå§‹åŒ–æ¸²æŸ“ã€çŠ¶æ€æ›´æ–°ä¹‹å
        render() {
          console.log("NewsList-render");
          /*
            Diffing ç®—æ³•ä¼šé€å±‚å¯¹æ¯”ï¼Œ
            å¯¹æ¯”æœ€å°ç²’åº¦æ˜¯æ ‡ç­¾ï¼Œ
            ä¸‹è¾¹ span æ ‡ç­¾ä¸­çš„ input æ ‡ç­¾ä¸ä¼šæ¯æ¬¡é‡æ–°ç”Ÿæˆ

          */
          return (
            <div>
              <h1>hello</h1>
              <input type="text" />
              <span>
                ç°åœ¨æ˜¯ï¼š{this.state.date.toTimeString()}
                <input type="text" />
              </span>
            </div>
          );
        }
      }
      ReactDOM.render(<Time />, document.getElementById("test"));
    </script>
  </body>
</html>
```

## React ä¸­çš„ `key` æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿï¼ˆé¢è¯•ä¸­å¸¸é—®ï¼‰
* `key` çš„å†…éƒ¨åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
* ä¸ºä»€ä¹ˆéå†åˆ—è¡¨æ—¶ï¼Œ`key` æœ€å¥½ä¸è¦ç”¨ `index` ï¼Ÿ


### `è™šæ‹Ÿ DOM` ä¸­ `key` çš„ä½œç”¨
* ç®€å•è¯´ï¼š`key` æ˜¯`è™šæ‹Ÿ DOM` å¯¹è±¡çš„æ ‡è¯†ï¼Œåœ¨æ›´æ–°æ˜¾ç¤ºæ—¶ `key` èµ·ç€æå…¶é‡è¦çš„ä½œç”¨
* è¯¦ç»†è¯´ï¼šå½“çŠ¶æ€ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œreact ä¼šæ ¹æ® `æ–°æ•°æ®` ç”Ÿæˆ `æ–°çš„è™šæ‹Ÿ DOM`ï¼Œç„¶å react è¿›è¡Œ `æ–°çš„è™šæ‹Ÿ DOM` ä¸ `æ—§çš„è™šæ‹Ÿ DOM` çš„ `diff` æ¯”è¾ƒï¼Œæ¯”è¾ƒè§„åˆ™å¦‚ä¸‹ï¼š
  1. å¦‚æœ `æ—§çš„è™šæ‹Ÿ DOM` ä¸­`æ‰¾åˆ°äº†`ä¸ `æ–°çš„è™šæ‹Ÿ DOM` ç›¸åŒçš„ `key`ï¼š
    - è‹¥ `è™šæ‹Ÿ DOM` ä¸­çš„å†…å®¹`æ²¡æœ‰æ”¹å˜`ï¼Œç›´æ¥ä½¿ç”¨ `çœŸå® DOM`
    - è‹¥ `è™šæ‹Ÿ DOM` ä¸­çš„å†…å®¹`æœ‰æ”¹å˜`ï¼Œåˆ™ç”Ÿæˆ `æ–°çš„çœŸå® DOM`ï¼Œéšåæ›¿æ¢æ‰é¡µé¢ä¸­ä¹‹å‰çš„ `çœŸå® DOM`ï¼š
  2. å¦‚æœ `æ—§çš„è™šæ‹Ÿ DOM` ä¸­ `æ²¡æœ‰æ‰¾åˆ°`ä¸ `æ–°çš„è™šæ‹Ÿ DOM` ç›¸åŒçš„ `key`ï¼š
    - åˆ™æ ¹æ®æ•°æ®åˆ›å»º`æ–°çš„çœŸå® DOM`ï¼Œç„¶åæ¸²æŸ“åˆ°é¡µé¢ä¸Š


### ç”¨ `index` ä½œä¸º `key` å¯èƒ½å¼•å‘é—®é¢˜ï¼š
1. è‹¥å¯¹æ•°æ®è¿›è¡Œï¼šé€†åºæ·»åŠ ã€é€†åºåˆ é™¤ç­‰ç ´åé¡ºåºçš„æ“ä½œï¼šä¼šäº§ç”Ÿæ²¡æœ‰å¿…è¦çš„ `çœŸå® DOM` æ›´æ–°ï¼Œç•Œé¢æ•ˆæœæ²¡é—®é¢˜ï¼Œä½†æ•ˆç‡ä½
2. å¦‚æœç»“æ„ä¸­è¿˜åŒ…å« `è¾“å…¥ç±»çš„ DOM`ï¼šä¼šäº§ç”Ÿé”™è¯¯ `DOM` æ›´æ–°ï¼Œç•Œé¢æœ‰é—®é¢˜

> Noteï¼šå¦‚æœä¸å­˜åœ¨å¯¹æ•°æ®çš„é€†åºæ·»åŠ ã€é€†åºåˆ é™¤ç­‰ç ´åé¡ºåºçš„æ“ä½œï¼Œä»…ç”¨äºæ¸²æŸ“åˆ—è¡¨ç”¨äºå±•ç¤ºï¼Œä½¿ç”¨ `index` ä½œä¸º `key` æ˜¯æ²¡æœ‰é—®é¢˜çš„
{: .prompt-info }


```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ç”Ÿå‘½å‘¨æœŸ-æ–°</title>
    <style>
      .list {
        width: 200px;
        height: 150px;
        background-color: skyblue;
        overflow: auto;
      }
      .news {
        height: 30px;
      }
    </style>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨ -->
    <div id="test"></div>

    <!-- å¼•å…¥ react æ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>

    <!-- å¼•å…¥ react-dom åº“ï¼Œç”¨äºæ”¯æŒ react æ“ä½œ DOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>

    <!-- å¼•å…¥ babelï¼Œç”¨äºå°† jsx è½¬ä¸º js -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <!-- å¼•å…¥ prop-typesï¼Œç”¨äºå¯¹ç»„ä»¶æ ‡ç­¾å±æ€§è¿›è¡Œé™åˆ¶ -->
    <script type="text/javascript" src="../js/prop-types.js"></script>

    <script type="text/babel">
      /*
        1. æ…¢åŠ¨ä½œå›æ”¾-----ä½¿ç”¨ index ç´¢å¼•å€¼ä½œä¸º key
        åˆå§‹æ•°æ®ï¼š
            { id: 1, name: "å°å¼ ", age: 18 },
            { id: 2, name: "å°ç‹", age: 20 },
        åˆå§‹çš„è™šæ‹Ÿ DOMï¼š
              <li key=0>å°å¼ ---19<input type="text" /></li>
              <li key=1>å°ç‹---20<input type="text" /></li>

        æ›´æ–°åçš„æ•°æ®ï¼š
            { id: 3, name: "å°èµµ", age: 20 },
            { id: 1, name: "å°å¼ ", age: 18 },
            { id: 2, name: "å°ç‹", age: 20 },
        æ›´æ–°åçš„è™šæ‹Ÿ DOMï¼š
              <li key=0>å°èµµ---20<input type="text" /></li>
              <li key=1>å°å¼ ---19<input type="text" /></li>
              <li key=2>å°ç‹---20<input type="text" /></li>

        é—®é¢˜ä¸€ï¼šç”±äºç”¨ index ä½œä¸º keyï¼Œå½“æ–°æ•°æ®æ’å…¥åˆ° list æœ€å‰è¾¹æ—¶ï¼Œ
        å¯¼è‡´ key æ”¹å˜äº†ï¼Œç„¶è€Œå°å¼ ã€å°ç‹å…¶å®æ˜¯å¯ä»¥å¤ç”¨çš„
        é—®é¢˜äºŒï¼šå¦‚æœ li æ ‡ç­¾åè¾¹æœ‰ input æ ‡ç­¾ï¼Œ
        ä¼šå› ä¸º index ä½œä¸º key çš„å˜åŒ–ï¼Œå¯¼è‡´å¤ç”¨æ—¶æ®‹ç•™ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¼•èµ·é”™ä¹±

        
        2. æ…¢åŠ¨ä½œå›æ”¾-----ä½¿ç”¨ id ä½œä¸º key
        åˆå§‹æ•°æ®ï¼š
            { id: 1, name: "å°å¼ ", age: 18 },
            { id: 2, name: "å°ç‹", age: 20 },
        åˆå§‹çš„è™šæ‹Ÿ DOMï¼š
              <li key=1>å°å¼ ---19<input type="text" /></li>
              <li key=2>å°ç‹---20<input type="text" /></li>

        æ›´æ–°åçš„æ•°æ®ï¼š
            { id: 3, name: "å°èµµ", age: 20 },
            { id: 1, name: "å°å¼ ", age: 18 },
            { id: 2, name: "å°ç‹", age: 20 },
        æ›´æ–°åçš„è™šæ‹Ÿ DOMï¼š
              <li key=3>å°èµµ---20<input type="text" /></li>
              <li key=1>å°å¼ ---19<input type="text" /></li> å¤ç”¨ï¼Œä¸å†ç”Ÿæˆæ–°çš„çœŸå® DOM
              <li key=2>å°ç‹---20<input type="text" /></li> å¤ç”¨ï¼Œä¸å†ç”Ÿæˆæ–°çš„çœŸå® DOM
        
        å› æ­¤ä½¿ç”¨ id ä½œä¸º keyï¼Œæ•ˆç‡æ›´é«˜
      */

      class Person extends React.Component {
        state = {
          persons: [
            { id: 1, name: "å°å¼ ", age: 18 },
            { id: 2, name: "å°ç‹", age: 20 },
          ],
        };

        componentDidMount() {}

        add = () => {
          const { persons } = this.state;
          const p = { id: persons.length + 1, name: "å°èµµ", age: 20 };
          this.setState({ persons: [p, ...persons] });
        };

        render() {
          return (
            <div>
              <h2>å±•ç¤ºä¸ªäººä¿¡æ¯</h2>
              <button onClick={this.add}>æ·»åŠ å°èµµ</button>
              <h3>ä½¿ç”¨ index ä½œä¸º key</h3>
              <ul>
                {this.state.persons.map((person, index) => {
                  return (
                    <li key={index}>
                      {person.name}---{person.age}
                      <input type="text" />
                    </li>
                  );
                })}
              </ul>
              <hr />
              <hr />
              <h3>ä½¿ç”¨ id ä½œä¸º key</h3>
              <ul>
                {this.state.persons.map((person) => {
                  return (
                    <li key={person.id}>
                      {person.name}---{person.age}
                      <input type="text" />
                    </li>
                  );
                })}
              </ul>
            </div>
          );
        }
      }
      ReactDOM.render(<Person />, document.getElementById("test"));
    </script>
  </body>
</html>
```

* ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨ `index` ä½œä¸º `key` æ—¶ï¼ŒåŒæ—¶å«æœ‰ `è¾“å…¥ç±»çš„ DOM` å¼•èµ·çš„æ•°æ®é”™ä¹±é—®é¢˜

![image](/assets/images/react/guide/index_key.png)


### æ€»ç»“ï¼šå¼€å‘ä¸­å¦‚ä½•é€‰æ‹© `key` ï¼Ÿ

> ä¼˜å…ˆä½¿ç”¨èƒ½å”¯ä¸€æ ‡è¯†ä¸€æ¡æ•°æ®çš„å±æ€§ä½œä¸º `key`ï¼Œä¾‹å¦‚ `id`ï¼Œ`èº«ä»½è¯å·`ï¼Œ`å­¦å·` ç­‰ã€‚å°½é‡é¿å…ä½¿ç”¨ `index` ä½œä¸º `key`ï¼Œå› ä¸ºå³ä½¿å½“å‰ä¸šåŠ¡é€»è¾‘ä½¿ç”¨ `index` ä½œä¸º `key` æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯éšç€
ä¸šåŠ¡çš„ä¸æ–­å˜åŒ–ï¼Œä¸èƒ½ä¿è¯æœªæ¥æ²¡æœ‰é€†åºæ·»åŠ ç­‰ç ´åé¡ºåºçš„æ“ä½œï¼Œæœ€ç»ˆé€ æˆé—®é¢˜ã€‚
{: .prompt-info }

