---
layout: post
title: Move-01-åŸºç¡€
date: 2022-08-21 16:45:30.000000000 +09:00
tag: åŒºå—é“¾
---

## ä¸ºä»€ä¹ˆé€‰æ‹© Move
1. é¢å‘èµ„æºç¼–ç¨‹
2. åŸç”Ÿæ€é¿å…åŒèŠ±
* å±ä¸»ä¸èµ„æºæ˜¯ç»‘å®šå…³ç³»ï¼Œèµ„äº§è½¬ç§»åï¼Œèµ„æºä¸åŸå±ä¸»å°±æ–­å¼€äº†ï¼Œæ‰€ä»¥å¯ä»¥åŸç”Ÿæ€é¿å…åŒèŠ±
3. å®‰å…¨å’Œå½¢å¼åŒ–éªŒè¯

## Move çš„ç»“æ„
åŒ…å« Modules å’Œ Scripts ä¸¤éƒ¨åˆ†

### Modules æ¨¡å—
* å¯ä»¥ç»“æ„åŒ–å®šä¹‰
* å‡½æ•°åŠŸèƒ½
* å…¨å±€å­˜å‚¨ï¼ˆçŠ¶æ€æ ‘ï¼‰

### Scripts è„šæœ¬
* å¯ä»¥å¼•ç”¨ Modulesï¼Œè°ƒç”¨ Modules çš„å‡½æ•°
* æš‚æ—¶çš„ä»£ç ç‰‡æ®µ
* 1 ä¸ª Scripts å†…åªèƒ½æœ‰ä¸€ä¸ªå‡½æ•°
* è´Ÿè´£å»è°ƒç”¨

{% highlight ruby %}

script {
    // Debug æ”¾åœ¨æŸä¸ª module ä¸‹ï¼Œè€Œ module è·Ÿåœ°å€æœ‰å…³ç³»ï¼Œ 0x1 åœ°å€å‘å¸ƒçš„ Debug åº“
    // import other module
    use 0x1::Debug; 

    // Move ä¸æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼Œåªæ”¯æŒ Numberï¼Œå¸ƒå°”ã€address ç±»å‹

    // main func just a nameï¼Œå«ä»€ä¹ˆåéƒ½è¡Œ
    // Noteï¼šscript é‡Œçš„å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œä½† Module é‡Œå‡½æ•°å¯ä»¥æœ‰è¿”å›å€¼
    fun main() {
        // u64 æ˜¯æ•°å€¼ç±»å‹
        let num:u64 = 1024;
        Debug::print(&num);
    }

}
{% endhighlight %}

https://playground.pontem.network/ çš„ç»“æ„åˆ†ä¸‰ä¸ªéƒ¨åˆ†

![](/assets/images/move/hello.png)

* scriptsï¼šè„šæœ¬å°±æ”¾è¿™é‡Œï¼Œæ”¾å…¶ä»–ä¿©åœ°æ–¹ä¼šæ‰¾ä¸åˆ°å‡½æ•°
* sources 
* tests


Run Scriptï¼šæŠŠ script ä¸­çš„å‡½æ•°åæ¯”å¦‚ main() è¾“å…¥ç„¶åå›è½¦

{% highlight ruby %}
https://playground.pontem.network/
å†™ä¸­æ–‡çš„æ³¨é‡Šä¼šæŠ¥ç¼–è¯‘é”™è¯¯ğŸ˜…
{% endhighlight %}

## Move æ•°æ®ç±»å‹

### æ•´å‹
* u8
* u64
* u128

### å¸ƒå°”
* true
* false

### åœ°å€ address
* address æ˜¯ Move çš„åœ°å€ç±»å‹ï¼Œå®ƒä¸ Solidity ä¸­çš„ address ç±»å‹æ²¡æœ‰å…³ç³»ï¼Œä½œç”¨ä¹Ÿä¸å¤ªä¸€æ ·ï¼ŒSolidity çš„ address å°±æ˜¯ç”¨æˆ·èº«ä»½
* Stdã€0x1 Sender ç­‰éƒ½æ˜¯ address ç±»å‹ï¼Œåœ°å€å¯ä»¥å‘½åæ–¹å¼æ¯”å¦‚ Senderï¼Œä¹Ÿå¯æ˜¯æ•°ç»„çš„æ¯”å¦‚ 0x1
* å‘½ååœ°å€ä¹Ÿä¼šå¯¹åº”ä¸€ä¸ªæ•°å€¼ï¼Œæœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»

![](/assets/images/move/addr.png)

* ç¼–è¯‘æ—¶å€™ä¼šæŠŠå‘½åçš„åœ°å€æ›¿æ¢æˆå¯¹åº”çš„æ•°å€¼ä¼ é€’ç»™ç¼–è¯‘å™¨ï¼Œï¼ˆæœ‰ç‚¹åƒå®å®šä¹‰ï¼‰

## Move å˜é‡å®šä¹‰çš„ 4 ä¸­æ–¹å¼
1. ç±»å‹æ¨å¯¼&èµ‹å€¼
* let a = 10; ç±»å‹æ¨å¯¼ä¸ºæ•´å‹

2. æ˜¾ç¤ºå®šä¹‰&èµ‹å€¼
* let b:u64 = 11; 

3. å€¼+ç±»å‹è¡¨ç¤º
* let c = 1u128; ç±»å‹æ˜¯ u128ï¼Œå€¼æ˜¯ 1

4. å…ˆå®šä¹‰åèµ‹å€¼
* let d:u8; d = 13;

{% highlight ruby %}
script {
    // import other module
    use 0x1::Debug; 

    // main func just a name
    fun main() {
        let num:u64 = 1024;
        Debug::print(&num);

        let b:u8 = 13;
        Debug::print(&b);

        let c = 1024u64;
        Debug::print(&c);

        let d = true;
        Debug::print(&d);

    }
}
{% endhighlight %}


## å‡½æ•°
* æ ¼å¼ï¼š[public] fun func_name(par) : ReturnType { }
1. å‚æ•°ç±»å‹åç½®ï¼Œå¯ä»¥ 0 æˆ–å¤šä¸ªå‚æ•°
2. è¿”å›å€¼å¯ä»¥æ˜¯ 0 æˆ–å¤šä¸ªï¼Œå¦‚æœå¤šä¸ªè¿”å›å€¼éœ€è¦ç”¨ ()
3. public è¡¨ç¤ºå…¬å¼€ï¼Œæ—  public è¡¨ç¤ºåªèƒ½å†…éƒ¨è®¿é—®ï¼Œä»…é™äº module å†…éƒ¨è®¿é—®
4. func_name Move å®˜æ–¹æ¨èå•è¯ç”¨ä¸‹åˆ’çº¿åˆ†å‰²

{% highlight ruby %}
// Viper æ˜¯å‘½ååœ°å€
// Math æ˜¯ module çš„åå­—
module Viper::Math {
    public fun sum(a: u64, b: u64): u64 {
        // æ²¡æœ‰åˆ†å·ï¼Œè¯­æ³•å¯ä»¥ç›´æ¥å†™è¿”å›å€¼çš„è¡¨è¾¾å¼ï¼Œæˆ– return a + b
        a + b
//        return a + b
    }

}

script {
    use Viper::Math;
    use 0x1::Debug;

    fun mainSum(a: u64, b: u64) {
        let c = Math::sum(a, b);
        Debug::print(&c);
    }
}
{% endhighlight %}

## as ä¸¤ç§ç”¨æ³•
### 1. ç±»å‹è½¬æ¢
{% highlight ruby %}
    public fun sum_2(a: u64, b: u8): u64 {
    // å› ä¸º + å·ä¼˜å…ˆçº§æ¯” as é«˜ï¼Œæ‰€ä»¥è¿™é‡Œè½¬æ¢éœ€è¦åŠ ä¸ªæ‹¬å·
        a + (b as u64)
//        return a + b
    }
{% endhighlight %}

### 2. åˆ«å
* use Viper::Math as MM;
* ç”¨ as åˆ«ååå°±ä¸èƒ½ç”¨åŸæ¥çš„ module åäº†
{% highlight ruby %}
script {
    use 0x1::Debug;
    use Viper::Math as MM;

    fun test_sum(a: u64, b: u64) {

        let c = MM::sum(a, b);
        Debug::print(&c);


        let d:u8 = 10;

        let e = MM::sum_2(a, d);
        Debug::print(&e);

    }

}
{% endhighlight %}

## if
{% highlight ruby %}
    public fun max(a:u64, b:u64) :u64 {
        if (a >= b) {
            a
        } else {
            b
        }
    }
{% endhighlight %}

## å¾ªç¯
{% highlight ruby %}
    public fun sum_to_a(a: u64) :u64 {
        let i:u64 = 1;
        let sum:u64 = 0;
        while(i <= a) {
            sum = sum + i;
            i = i + 1;
        };  // Noteï¼šè¿™é‡Œæ³¨æ„è¦æœ‰ä¸ª ; ğŸ¤£
        sum
    }
    
    // continue ä½¿ç”¨
    public fun sum_99() :u64 {
        let i:u64 = 0;
        let sum:u64 = 0;

        while(i <= 99) {
            i = i + 1;
            if (i % 2 == 0) {
                continue;
            };
            sum = sum + i;
        };
        sum
    }
{% endhighlight %}

## ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ

### å…¨å±€å˜é‡
* const
* module å†…æˆ– script å†…
* å¸¸é‡å®šä¹‰å¿…é¡»å¤§å†™å¼€å¤´ï¼Œé¦–å­—æ¯ A~Z
* å®šä¹‰å…¨å±€å¸¸é‡å¯ä»¥ï¼Œå…¨å±€å˜é‡ä¸è¡Œ

### å±€éƒ¨å˜é‡
* let å…³é”®å­—
* å‡½æ•°å†…
* é¦–å­—æ¯ a~z

![](/assets/images/move/scope.png)


{% highlight ruby %}
    fun test_sum_100(a: u64) {
        Debug::print(&MM::sum_to_a(a));
        Debug::print(&MM::sum_99());

        let r:u64 = 10;
        let area = MM::get_area(r);
        Debug::print(&area);
        // Noteï¼šåœ°å€ç±»å‹æ”¾åˆ°è¡¨è¾¾å¼é‡Œå°±éœ€è¦ç”¨ @

        let addr:address = @Viper;
        Debug::print(&addr);
    }   
{% endhighlight %}

## abort å’Œ asset
### abort 
* ä¸€ä¸ªå…³é”®å­—
* ç”¨æ³•ï¼šabort 0
* ä½œç”¨æ˜¯ï¼šç»ˆæ­¢æ‰§è¡Œï¼Œæ¢å¤äº‹åŠ¡

{% highlight ruby %}
if (r < 10) {
    abort 10;
}; åˆ«å¿˜äº†è¿™è¯¥æ­»çš„ ; ğŸ¤£

è¾“å‡ºï¼šExecution aborted with code 10 in transaction script
{% endhighlight %}


### assert
* è°ƒç”¨ï¼šassert!(cond, code)ï¼Œcond ä¸ºå‡ï¼Œå°±ä¼šæ‰§è¡Œ code
* å®å®šä¹‰ï¼Œå°è£…äº† abort çš„ä½¿ç”¨ï¼Œå†…éƒ¨å°±æ˜¯è°ƒç”¨äº† abort

{% highlight ruby %}
assert!(r >= 10, 10);

è¾“å‡ºï¼šExecution aborted with code 10 in transaction script
{% endhighlight %}

## å…ƒç»„
* ä½¿ç”¨å°æ‹¬å·ç»„åˆå¤šä¸ªå˜é‡æˆ–å€¼ï¼Œä¾‹å¦‚ (x,y), (10,20,30)
* å‡½æ•°å¤šä¸ªè¿”å›å€¼çš„å®šä¹‰ä¸æ¥æ”¶
* å¤šä¸ªå˜é‡çš„åŒæ—¶å®šä¹‰

* Move ä¸­å˜é‡æ”¯æŒé‡å¤å®šä¹‰ï¼Œä¼šä½¿ç”¨æœ€æ–°çš„
{% highlight ruby %}
let (x, y) = (10, 19);
let (x, y) = (20, 30);

let (m, _) = (1, 2); // _ å ä½

{% endhighlight %}

## å¼•ç”¨
* é€šè¿‡å¼•ç”¨å®šä¹‰å˜é‡çš„åˆ«å
* å¼•ç”¨å¯ä»¥é¿å…ç›´æ¥æš´éœ²åœ°å€

* Move çš„ä¸¤ç§å¼•ç”¨æ–¹å¼
1. ä¸å¯å˜å¼•ç”¨ &
2. å¯å˜å¼•ç”¨ &mut
3. \* ä»£è¡¨è§£é™¤å¼•ç”¨ï¼ŒæŒ‡å‘å¼•ç”¨å¯¹åº”çš„å€¼ï¼›å·¦å€¼ç”¨äºèµ‹å€¼éœ€è¦ &mutï¼›å³å€¼ç”¨äºè¯»å–

{% highlight ruby %}
let (x, y) = (20, 30);

// m å¼•ç”¨ x 
let m:&u64 = &x;
Debug::print(m); // 20
{% endhighlight %}

### swap
{% highlight ruby %}
// &mut
public fun swap(a:&mut u64, b:&mut u64) {
    let temp = *a;
    *a = *b;
    *b = temp;
}

let a:u64 = 10;
let b:u64 = 20;

MM::swap(&mut a, &mut b);
Debug::print(&a);
Debug::print(&b);

{% endhighlight %}

## æ³›å‹ Generics
* ä»£ç é€»è¾‘ä¸ç±»å‹æ— å…³
* æ³›å‹å…è®¸ç¨‹åºå‘˜åœ¨å¼ºç±»å‹ç¨‹åºè®¾è®¡è¯­è¨€ä¸­ç¼–å†™ä»£ç æ—¶ä½¿ç”¨ä¸€äº›ä»¥åæ‰æŒ‡å®šçš„ç±»å‹ï¼Œåœ¨å®ä¾‹åŒ–æ—¶ä½œä¸ºå‚æ•°æŒ‡æ˜è¿™äº›ç±»å‹

{% highlight ruby %}
// æ³›å‹éœ€è¦å£°æ˜æœ‰ drop çš„èƒ½åŠ›
public fun show<T:drop>(x:T) {
    Debug::print(&x);
}

MM::show(a);
{% endhighlight %}

## Vector
* Vector Move æä¾›çš„æ³›å‹å®¹å™¨

{% highlight ruby %}
use 0x1::Vector;

// a array of string's ASCII
let str = b"hello";
// [104, 101, 108, 108, 111]
Debug::print(&str);

let v2 = Vector::empty<u64>();

// add 10 to v2 list
Vector::push_back(&mut v2, 10);
Vector::push_back(&mut v2, 20);
// [10, 20]
Debug::print(&v2);
{% endhighlight %}


### Vector å¸¸ç”¨ API

* ç»ˆæ­¢æ˜¯æŒ‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯å¦ä¼šæœ‰ abort æ“ä½œ

![](/assets/images/move/vector1.png)

![](/assets/images/move/vector2.png)

![](/assets/images/move/vector3.png)

{% highlight ruby %}
let v3 = Vector::empty<u64>();
Vector::push_back(&mut v3, 30);
Vector::push_back(&mut v3, 40);
Vector::push_back(&mut v3, 50);

Vector::append<u64>(&mut v2, v3);
Debug::print(&v2);

Vector::reverse<u64>(&mut v2);
Debug::print(&v2);

let x = 10;
let (flag, index) = Vector::index_of<u64>(&v2, &x);
Debug::print(&flag);
Debug::print(&index);
{% endhighlight %}
