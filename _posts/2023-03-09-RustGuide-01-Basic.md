---
layout: post
title: RustGuide-01-Basic
date: 2023-03-09 16:45:30.000000000 +09:00
categories: [Rust, Rust Getting Start]
tags: [Rust, Rust Getting Start]
---

# ç›¸å…³å‘½ä»¤

* æŸ¥çœ‹ç‰ˆæœ¬ï¼Œä¾‹å¦‚ rustc 1.68.0 (2c8cc3432 2023-03-06)
1. 2c8cc3432 commit hash
2. 1.68.0 ç‰ˆæœ¬

```
$ rustc --version
```

* æ›´æ–°
```
$ rustup update
```

* å¸è½½
```
$ rustup self uninstall
```

* æœ¬åœ°æ–‡æ¡£
```
$ rustup doc
```

# Hello World

* rust æ–‡ä»¶åç¼€åç§° .rs
* å‘½åè§„èŒƒï¼šå•è¯ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼Œä¾‹å¦‚ hello_word.rs
```rust
// main å‡½æ•°å¼ Rust ç¨‹åºå…¥å£
// Rust ç¼©è¿›æ˜¯ 4 ä¸ªç©ºæ ¼ï¼Œè€Œä¸æ˜¯ Tab
fn main() {
    // println! æ˜¯ä¸€ä¸ªå®ï¼Œå‡½æ•°æ²¡æœ‰ !
    println!("hello world!");
}
```

* è¿è¡Œ Rust ç¨‹åºå‰å¿…é¡»å…ˆç¼–è¯‘ï¼Œä½¿ç”¨ rustc å‘½ä»¤ç¼–è¯‘
```
$ rustc main.rs
```
* ç¼–è¯‘æˆåŠŸåç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œrustc åªé€‚åˆç®€å•ç¨‹åº

# Cargo
* Cargo æ˜¯ Rust çš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å·¥å…·ï¼Œç”¨äºæ„å»ºä»£ç ï¼Œä¸‹è½½ä¾èµ–åº“
* æŸ¥çœ‹ Cargo ç‰ˆæœ¬
```
$ cargo --version
```
* ä½¿ç”¨ Cargo åˆ›å»ºæ–°é¡¹ç›®ï¼Œcargo new `é¡¹ç›®å`
```
$ cargo new hello_world
```
* ç”Ÿæˆæ–°é¡¹ç›®ç›®å½•ç»“æ„
1. Cargo.toml é…ç½®æ–‡ä»¶
2. src æ–‡ä»¶å¤¹ï¼Œç”¨äºæ”¾æºä»£ç 
3. é¡¶å±‚ç›®å½•å¯ä»¥æ”¾ READMEã€è®¸å¯ä¿¡æ¯ã€é…ç½®æ–‡ä»¶ã€å…¶ä»–è·Ÿæºä»£ç æ— å…³çš„æ–‡ä»¶
4. å¦‚æœæ²¡æœ‰ä½¿ç”¨ Cargo åˆ›å»ºé¡¹ç›®ï¼Œä¹Ÿå¯æ‰‹åŠ¨å˜æˆ Cargo å½¢å¼ï¼Œå³æŠŠæºä»£ç æ”¾åˆ° src ç›®å½•ä¸‹ï¼Œå¹¶æ·»åŠ  Cargo.toml é…ç½®æ–‡ä»¶

* Tomlï¼ˆTomeâ€˜s Obviousï¼ŒMinimal Language æ ¼å¼ï¼‰æ–‡ä»¶



```
[package] // è¡¨ç¤ºåŒºåŸŸæ ‡é¢˜ï¼Œä¸‹æ–¹å†…å®¹æ˜¯æ¥é…ç½® package çš„
name = "hello_world"  // é¡¹ç›®å
version = "0.1.0"     // é¡¹ç›®ç‰ˆæœ¬
edition = "2021"      // ä½¿ç”¨çš„ Rust ç‰ˆæœ¬

[dependencies] // é¡¹ç›®çš„ä¾èµ–é¡¹
```

> åœ¨ Rust é‡Œï¼Œä»£ç çš„åŒ…ç§°ä¸º crate
{: .prompt-info }


## Build Cargo é¡¹ç›®
```
$ cargo build
```
ç”Ÿæˆæ–‡ä»¶è·¯å¾„ï¼š/target/debug/{é¡¹ç›®å}

> ç¬¬ä¸€æ¬¡ cargo build ä¼šåœ¨é¡¶å±‚ç›®å½•ç”Ÿæˆ cargo.lockï¼Œcargo.lock è´Ÿè´£è¿½è¸ªé¡¹ç›®ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬ï¼ˆç±»ä¼¼ Podfile.lockï¼‰
{: .prompt-info }

## Run Cargo é¡¹ç›®
ç¼–è¯‘ + è¿è¡Œé¡¹ç›®
```
$ cargo run
```
* å¦‚æœä¹‹å‰ç¼–è¯‘æˆåŠŸè¿‡ï¼Œå¹¶ä¸”æºä»£ç æ²¡æœ‰æ”¹åŠ¨ï¼Œé‚£å°±ç›´æ¥è¿è¡Œç¨‹åº

## Check Cargo é¡¹ç›®
* ç”¨äºæ£€æŸ¥ä»£ç ï¼Œç¡®ä¿ç¼–è¯‘èƒ½é€šè¿‡ï¼Œä½†ä¸äº§ç”Ÿä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶
```
$ cargo check
```

> cargo check æ¯” cargo build å¿«çš„å¤šï¼Œæ‰€ä»¥å¼€å‘æ—¶å¯ä»¥ç”¨ cargo checkï¼Œåˆ°ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶æ—¶å€™å†ç”¨ cargo build
{: .prompt-info }

## ä¸ºå‘å¸ƒæ„å»º
* ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä»£ç ä¼šè¿è¡Œæ›´å¿«ï¼Œä½†æ˜¯ç¼–è¯‘æ—¶é—´æ›´é•¿
* å¯æ‰§è¡Œæ–‡ä»¶ç”Ÿæˆåœ¨ target/release ä¸‹
```
$ cargo build --release
```



# çŒœæ•°æ¸¸æˆ


## å˜é‡

* rust é»˜è®¤å˜é‡éƒ½æ˜¯ immutable ä¸å¯å˜çš„
* åœ¨å˜é‡å‰åŠ  mut è¡¨ç¤ºå˜é‡æ˜¯å¯å˜çš„ mutable

```rust
let foo = 1;
// foo = 2; // error can't assign twice to immutable variable 

let mut _bar = foo; // rust é»˜è®¤å˜é‡éƒ½æ˜¯ immutable ä¸å¯å˜çš„
_bar = 3;  // åœ¨å˜é‡å‰åŠ  mut è¡¨ç¤ºå˜é‡æ˜¯å¯å˜çš„ mutable
```



```rust
// å¼•ç”¨æ ‡å‡†åº“ std çš„ io åº“ å¯ä»¥ä½¿ç”¨ io
/*
rust é»˜è®¤æŠŠ preludeï¼ˆé¢„å¯¼å…¥ï¼‰ å¯¼å…¥åˆ°ç¨‹åºçš„æ¯ä¸ªä½œç”¨åŸŸä¸­,å¦‚æœä½ ä½¿ç”¨çš„ç±»å‹ prelude é‡Œæ²¡æœ‰
è¿™æ—¶ä½ éœ€è¦è‡ªè¡Œå¯¼å…¥, å°±æ˜¯ä½¿ç”¨ use å¯¼å…¥åº“
 */
use std::io;

// fn å³å£°æ˜ä¸€ä¸ªå‡½æ•°
fn main() {
    println!("çŒœæ•°!");
    println!("çŒœä¸€ä¸ªæ•°");

    // rust ä¸­ String ä½¿ç”¨ utf-8 ç¼–ç 
    // :: ä¸¤ä¸ªå†’å·è¡¨ç¤ºåè¾¹çš„æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•
    // è¿™é‡Œ new å‡½æ•°åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å­—ç¬¦ä¸²
    let mut guess = String::new();

    // 1 è¯»å–ä¸€è¡Œä¸œè¥¿ï¼Œå¹¶æ”¾åˆ° guess å­—ç¬¦ä¸²å¼•ç”¨é‡Œ
    // 2 expect ä¸ºæŠ›å‡ºå¼‚å¸¸æ—¶å€™è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
    // 3 & è¡¨ç¤ºå‚æ•°æ˜¯ä¸€ä¸ªå¼•ç”¨
    // 4 read_line å‚æ•°æ˜¯éœ€è¦ä¸€ä¸ªå¼•ç”¨
    // 5 å¼•ç”¨é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„æ¯”å¦‚ &guess, æ‰€ä»¥ &mut å°±æ˜¯å¯å˜å¼•ç”¨
    // 
    /* 
        6   
       read_line è¿”å› Result ç±»å‹ï¼ŒResult å°±æ˜¯æšä¸¾ç±»å‹
       io::Result æœ‰ä¸¤ä¸ªå€¼ OK å’Œ Err
       å¦‚æœæ˜¯ OK è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå¹¶ä¸”é‡Œè¾¹æœ‰ç»“æœ
       å¦‚æœæ˜¯ Err è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼ŒErr é‡Œæœ‰å¤±è´¥ reason
       expect æ˜¯ Result çš„æ–¹æ³•ï¼Œå¦‚æœè¿”å› Err åˆ™ expect ä¼šä¸­æ–­ç¨‹åºï¼Œå°†ä¼ å…¥å­—ç¬¦ä¸²æ˜¾ç¤º
       å¦‚æœè¿”å› OKï¼Œexpect å°±å°†ç”¨æˆ·è¾“å…¥çš„å€¼è¿”å›
     */
    io::stdin().read_line(&mut guess).expect("æ— æ³•è¯»å–è¡Œ");

    // {} æ˜¯ä¸€ä¸ªå ä½ï¼Œè¾“å‡ºæ—¶å€™ä¼šè¢«æ›¿æ¢æˆ guess å˜é‡çš„å€¼
    // ä¸€ä¸ª {} å¯¹åº”ä¸€ä¸ªå˜é‡çš„å€¼
    println!("ä½ çŒœæµ‹çš„æ•°æ˜¯ï¼š{}", guess);

}

```

## format

* å®‰è£… format
```
$ rustup component add rustfmt
```

* å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–
```
$ cargo fmt
```


## éšæœºæ•°
[éšæœºæ•°](https://crates.io/crates/rand)

* ä¸€ä¸ª crate å°±æ˜¯ä¸€ä¸ªåº“


### æ·»åŠ ä¾èµ–åº“ rand
* æ–¹æ³•ä¸€ï¼šç›´æ¥åœ¨ cargo.toml ä¸­æ·»åŠ  rand åº“

```
[dependencies]
rand = "0.8.5"  // æŒ‡å®šç‰ˆæœ¬å·

```

ä¹‹å vscode ä¼šä¸‹è½½ä¾èµ–åº“ï¼Œä¸‹è½½å¥½åå¯æ‰§è¡Œ `cargo build`

* æ–¹æ³•äºŒï¼šå‘½ä»¤è¡Œ `cargo add`ï¼ˆæ¨èï¼‰

```
// ä½¿ç”¨ rand æœ€æ–°ç‰ˆæœ¬
$ cargo add rand

// ç›´åˆ° rand ç‰ˆæœ¬ä¸º 0.8.5
$ cargo add rand@0.8.5
```

### æ›´æ–°ä¾èµ–åº“ï¼Œä½¿ç”¨å‘½ä»¤ `cargo update`
* ä¼šå¿½ç•¥ cargo.lock ä¸­çš„ç‰ˆæœ¬ï¼Œæ¥æ‰¾åˆ° cargo.toml é‡Œç¬¦åˆçš„ç‰ˆæœ¬

```
$ cargo update
```

* ç”Ÿæˆéšæœºæ•°

```rust

// Rng æ˜¯ä¸€ä¸ª traitï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªåè®®
use rand::Rng; // trait

    /* 
        ThreadRng å°±æ˜¯ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå®ƒæ˜¯ä½äºæœ¬åœ°çº¿ç¨‹ç©ºé—´
        å¹¶é€šè¿‡ç³»ç»Ÿè·å¾—éšæœºæ•°çš„ç§å­
        gen_range åœ¨ [1, 101) ä¹‹é—´è·å–éšæœºæ•°
    */
    let rand_number = rand::thread_rng().gen_range(1..101);
    println!("ç¥ç§˜æ•°å­—æ˜¯ {}", rand_number);
```

> command+shift+p æŸ¥æ‰¾å¼€å¯ rust server
{: .prompt-info }


## çŒœæ•°æ¸¸æˆå…¨éƒ¨ä»£ç 
```rust
// å¼•ç”¨æ ‡å‡†åº“ std çš„ io åº“ å¯ä»¥ä½¿ç”¨ io
/*
rust é»˜è®¤æŠŠ preludeï¼ˆé¢„å¯¼å…¥ï¼‰ å¯¼å…¥åˆ°ç¨‹åºçš„æ¯ä¸ªä½œç”¨åŸŸä¸­,å¦‚æœä½ ä½¿ç”¨çš„ç±»å‹ prelude é‡Œæ²¡æœ‰
è¿™æ—¶ä½ éœ€è¦è‡ªè¡Œå¯¼å…¥, å°±æ˜¯ä½¿ç”¨ use å¯¼å…¥åº“
 */
use std::io;
// Rng æ˜¯ä¸€ä¸ª traitï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªåè®®
use rand::Rng; // trait

// å¼•å…¥ Orderingï¼ŒOrdering æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹å®ƒæœ‰ä¸‰ä¸ªå€¼
use std::cmp::Ordering;

// fn å³å£°æ˜ä¸€ä¸ªå‡½æ•°
fn main() {
    println!("çŒœæ•°!");

    /*
        ThreadRng å°±æ˜¯ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå®ƒæ˜¯ä½äºæœ¬åœ°çº¿ç¨‹ç©ºé—´
        å¹¶é€šè¿‡ç³»ç»Ÿè·å¾—éšæœºæ•°çš„ç§å­
        gen_range åœ¨ [1, 101) ä¹‹é—´è·å–éšæœºæ•°
    */
    let rand_number = rand::thread_rng().gen_range(1..101);
    println!("ç¥ç§˜æ•°å­—æ˜¯ {}", rand_number);

    // æ— é™å¾ªç¯ä½¿ç”¨ loop å…³é”®å­—
    loop {
        println!("çŒœä¸€ä¸ªæ•°---- Begin");
        // rust ä¸­ String ä½¿ç”¨ utf-8 ç¼–ç 
        // :: ä¸¤ä¸ªå†’å·è¡¨ç¤ºåè¾¹çš„æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•
        // è¿™é‡Œ new å‡½æ•°åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å­—ç¬¦ä¸²
        let mut guess = String::new();

        // 1 è¯»å–ä¸€è¡Œä¸œè¥¿ï¼Œå¹¶æ”¾åˆ° guess å­—ç¬¦ä¸²å¼•ç”¨é‡Œ
        // 2 expect ä¸ºæŠ›å‡ºå¼‚å¸¸æ—¶å€™è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
        // 3 & è¡¨ç¤ºå‚æ•°æ˜¯ä¸€ä¸ªå¼•ç”¨
        // 4 read_line å‚æ•°æ˜¯éœ€è¦ä¸€ä¸ªå¼•ç”¨
        // 5 å¼•ç”¨é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„æ¯”å¦‚ &guess, æ‰€ä»¥ &mut å°±æ˜¯å¯å˜å¼•ç”¨
        //
        /*
           6
          read_line è¿”å› Result ç±»å‹ï¼ŒResult å°±æ˜¯æšä¸¾ç±»å‹
          io::Result æœ‰ä¸¤ä¸ªå€¼ OK å’Œ Err
          å¦‚æœæ˜¯ OK è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå¹¶ä¸”é‡Œè¾¹æœ‰ç»“æœ
          å¦‚æœæ˜¯ Err è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼ŒErr é‡Œæœ‰å¤±è´¥ reason
          expect æ˜¯ Result çš„æ–¹æ³•ï¼Œå¦‚æœè¿”å› Err åˆ™ expect ä¼šä¸­æ–­ç¨‹åºï¼Œå°†ä¼ å…¥å­—ç¬¦ä¸²æ˜¾ç¤º
          å¦‚æœè¿”å› OKï¼Œexpect å°±å°†ç”¨æˆ·è¾“å…¥çš„å€¼è¿”å›
        */
        io::stdin().read_line(&mut guess).expect("æ— æ³•è¯»å–è¡Œ");

        // ç±»å‹éšè—ï¼Œrust å¯ä»¥è®©å®šä¹‰åŒåçš„å˜é‡ï¼Œä¸€èˆ¬ç”¨äºç±»å‹è½¬æ¢
        // ä»è¿™è¡Œåè¾¹ guess å°±æ˜¯ u32 ç±»å‹äº†
        // trim ä¼šå»æ‰å­—ç¬¦ä¸²çš„ç©ºç™½
        // parse å°†å­—ç¬¦ä¸²è½¬ä¸º number ç±»å‹
        // shadow
        //let guess: u32 = guess.trim().parse().expect("Please type a number !");

        // ä¼˜åŒ– match æ˜¯ rust è¿›è¡ŒåŒ¹é…çš„é‡è¦æ¨¡å¼
        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,     // if æ˜¯ ok åˆ™å°†å€¼è¿”å›
            Err(_) => continue, //  if æ˜¯ error åˆ™è·³è¿‡æœ¬æ¬¡è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯
        };

        // {} æ˜¯ä¸€ä¸ªå ä½ï¼Œè¾“å‡ºæ—¶å€™ä¼šè¢«æ›¿æ¢æˆ guess å˜é‡çš„å€¼
        // ä¸€ä¸ª {} å¯¹åº”ä¸€ä¸ªå˜é‡çš„å€¼
        println!("ä½ çŒœæµ‹çš„æ•°æ˜¯ï¼š{}", guess);

        // æ‹¿ guess ä¸ rand_number è¿›è¡Œæ¯”è¾ƒ
        /*
           Ordering æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹å®ƒæœ‰ä¸‰ä¸ªå€¼ï¼ŒLessã€Greaterã€Equal


           ä¸€ä¸ª match è¡¨è¾¾å¼ç”±å¤šä¸ª arm ç»„æˆï¼Œ
           å¦‚æœ match åè¾¹çš„å€¼è·ŸæŸä¸ª arm åŒ¹é…äº†ï¼Œé‚£å°±æ‰§è¡Œé‚£ä¸ª arm çš„è¯­å¥ï¼Œ
           match åŒ¹é…æ˜¯ä»ä¸Šåˆ°ä¸‹ä»£ç è¿›è¡ŒåŒ¹é…çš„
        */
        /*
           rust æ˜¯é™æ€çš„å¼ºç±»å‹è¯­è¨€ï¼Œæœ‰ç±»å‹æ¨æ–­çš„èƒ½åŠ›
           æŠŠ match ä¸‹æ³¨é‡Šæ‰ rand_number å°±å˜æˆ i32 ç±»å‹äº†ï¼Œ
           æœ‰ä¸‹è¾¹ match ä»£ç  rand_number å°±æ˜¯ u32 ç±»å‹ï¼Œå› ä¸º guess æ˜¯ u32ï¼Œæ¯”è¾ƒæ—¶ç±»å‹è¦ä¸€æ ·
        */
        match guess.cmp(&rand_number) {
            Ordering::Less => println!("Too small"), // è¿™æ˜¯ä¸€ä¸ª arm
            Ordering::Greater => println!("Too great"),
            Ordering::Equal => {
                println!("You winï¼");
                break; // è·³å‡º loop å¾ªç¯
            }
        }
        println!("çŒœä¸€ä¸ªæ•°---- End");
    }
}
```

# åŸºç¡€

## æ‰“å°

```rust
    let x = 10;
    println!("x is {x}");
```

## å˜é‡ä¸å¯å˜æ€§
* å£°æ˜å˜é‡ä½¿ç”¨ `let` å…³é”®å­—
* é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰
* åœ¨å£°æ˜å˜é‡æ—¶ï¼Œåœ¨å˜é‡å‰åŠ ä¸Š mutï¼Œå°±å¯ä»¥ä½¿å˜é‡å˜ä¸ºå¯å˜çš„

```rust
let mut x = 5;
println!("the x is {}", x);

x = 6;
println!("the x is {}", x);
```


## å¸¸é‡ä¸å˜é‡
* å¸¸é‡ï¼ˆconstantï¼‰åœ¨ç»‘å®šå€¼åä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å®ƒä¸ä¸å¯å˜çš„å˜é‡æœ‰å¾ˆå¤šåŒºåˆ«
1. å¸¸é‡ä¸èƒ½ä½¿ç”¨ mut å…³é”®å­—ï¼Œå› ä¸ºå¸¸é‡æ°¸è¿œéƒ½ä¸å¯å˜
2. å£°æ˜å¸¸é‡ä½¿ç”¨ const å…³é”®å­—ï¼Œå¹¶ä¸”å®ƒçš„ç±»å‹å¿…é¡»è¢«æ ‡æ³¨æ¸…æ¥š
3. å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå†…è¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ
4. å¸¸é‡åªèƒ½ç»‘å®šåˆ°å¸¸é‡è¡¨è¾¾å¼ä¸Šï¼Œæ— æ³•ç»‘å®šåˆ°å‡½æ•°çš„è°ƒç”¨ç»“æœæˆ–åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å‡ºçš„å€¼
5. åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¸¸é‡åœ¨å…¶å£°æ˜çš„ä½œç”¨åŸŸå†…ä¸€ç›´æœ‰æ•ˆ

* å¸¸é‡çš„å‘½åè§„èŒƒï¼šRust é‡Œå¸¸é‡ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œæ¯ä¸ªå•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼Œä¾‹å¦‚ MAX_HEIGHT
* å¸¸é‡å£°æ˜ä¾‹å­
```rust
const MAX_HEIGHT: u32 = 100_000;
```


## Shadowing (éšè—)
* åœ¨ Rust ä¸­å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åå­—å£°æ˜æ–°çš„å˜é‡ï¼Œæ–°çš„å˜é‡ä¼š shadowï¼ˆéšè—ï¼‰ä¹‹å‰å£°æ˜çš„åŒåå˜é‡

```rust
let y = 5;
let y = y + 1; // shadowing ï¼Œåœ¨åç»­ä»£ç ä¸­è¿™ä¸ªå˜é‡ y å°±ä»£è¡¨æ–°çš„å˜é‡ y
```

* shadow ä¸ mut æ ‡è®°æ˜¯ä¸ä¸€æ ·çš„
1. ä½¿ç”¨ let å£°æ˜ï¼ˆshadowï¼‰çš„æ–°å˜é‡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„
2. ä½¿ç”¨ let å£°æ˜ï¼ˆshadowï¼‰çš„æ–°å˜é‡ï¼Œå®ƒçš„ç±»å‹å¯ä»¥ä¸ä¹‹å‰çš„ä¸åŒ

```rust
let spaces = "    ";          // ç±»å‹æ˜¯ &str
let spaces = spaces.len();    // ç±»å‹æ˜¯ usize
println!("spaces {}", spaces);    
```

# æ•°æ®ç±»å‹
* æ ‡é‡å’Œå¤åˆç±»å‹
* rust æ˜¯é™æ€ç¼–è¯‘è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹
1. åŸºäºä½¿ç”¨çš„å€¼ï¼Œç¼–è¯‘å™¨é€šå¸¸èƒ½å¤Ÿæ¨æ–­å‡ºå®ƒçš„å…·ä½“ç±»å‹
2. ä½†å¦‚æœå¯èƒ½çš„ç±»å‹æ¯”è¾ƒå¤šï¼ˆä¾‹å¦‚æŠŠ String è½¬ä¸ºæ•´æ•°çš„ parse æ–¹æ³•ï¼‰ï¼Œå°±å¿…é¡»æ·»åŠ ç±»å‹çš„æ ‡æ³¨ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™


```rust
let guess: u32 = "42".parse().expect("Not a number");
println!("guess {}", guess);
```

## æ ‡é‡ç±»å‹
* ä¸€ä¸ªæ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼
* rust æœ‰ 4 ä¸ªä¸»è¦çš„æ ‡é‡ç±»å‹
1. æ•´æ•°ç±»å‹
2. æµ®ç‚¹ç±»å‹
3. å¸ƒå°”ç±»å‹
4. å­—ç¬¦ç±»å‹

## æ•´æ•°ç±»å‹
* ä¾‹å¦‚ u32 æ˜¯ä¸€ä¸ªæ— ç¬¦å·ï¼Œå  32 ä½çš„ç©ºé—´çš„æ•´æ•°
* æ— ç¬¦å·ä»¥ u å¼€å¤´ï¼ŒèŒƒå›´ 0~2^n - 1
* æœ‰ç¬¦å·ä»¥ i å¼€å¤´ï¼ŒèŒƒå›´ -2^(n - 1)~2^(n - 1) - 1


![image](/assets/images/rust/integer.png)


* isize å’Œ usize ç±»å‹ï¼Œarch è¡¨ç¤ºç³»ç»Ÿçš„æ¶æ„
1. ç”±ç¨‹åºè¿è¡Œçš„è®¡ç®—æœºæ¶æ„å†³å®šï¼Œå¦‚æœæ˜¯ 64 ä½çš„é‚£å°±æ˜¯ 64 ä½ï¼Œå¦‚æœæ˜¯ 32 ä½é‚£å°±æ˜¯ 32 ä½çš„
2. ä½¿ç”¨åœºæ™¯ä¸å¤šï¼Œä¸»è¦åœºæ™¯æ˜¯å¯¹æŸç§é›†åˆè¿›è¡Œç´¢å¼•æ“ä½œ

* æ•´æ•°çš„å­—é¢å€¼
1. é™¤äº† byte ç±»å‹å¤–ï¼Œæ‰€æœ‰æ•°å€¼å­—é¢é‡éƒ½å…è®¸ä½¿ç”¨ç±»å‹åç¼€
2. å¦‚ 57u8ï¼Œå³å€¼æ˜¯ 57 ç±»å‹æ˜¯ u8

> æ•´æ•°çš„é»˜è®¤ç±»å‹æ˜¯ i32ï¼Œé€Ÿåº¦è¾ƒå¿«
{: .prompt-info }


![image](/assets/images/rust/iliteral.png)


### æ•´æ•°çš„æº¢å‡º
* ä¾‹å¦‚ u8 çš„èŒƒå›´æ˜¯ 0~255ï¼Œå¦‚æœæŠŠ u8 å˜é‡çš„å€¼è®¾ç½®ä¸º 256
1. åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ç¼–è¯‘ï¼šrust ä¼šæ£€æŸ¥æ•´æ•°æº¢å‡ºï¼Œå¦‚æœå‘ç”Ÿæº¢å‡ºï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶å°±ä¼š panic
2. åœ¨å‘å¸ƒæ¨¡å¼ä¸‹ï¼ˆ--releaseï¼‰ç¼–è¯‘ï¼šrust ä¸ä¼šæ£€æŸ¥å¯èƒ½å¯¼è‡´ panic çš„æ•´æ•°æº¢å‡ºï¼Œ
3. åœ¨å‘å¸ƒæ¨¡å¼ä¸‹ï¼Œå¦‚æœå‘ç”Ÿæº¢å‡ºä¼šè¿›è¡Œç¯ç»•æ“ä½œï¼Œ256 å˜ä¸º 0, 257å˜ä¸º 1ï¼Œä¸ä¼š panic

## æµ®ç‚¹ç±»å‹
* f32ï¼Œ32 ä½ï¼Œå•ç²¾åº¦
* f64ï¼Œ64 ä½ï¼ŒåŒç²¾åº¦

* rust æµ®ç‚¹ç±»å‹ä½¿ç”¨äº† IEEE-754 æ ‡å‡†æ¥è¡¨ç¤º

> f64 æ˜¯é»˜è®¤çš„æµ®ç‚¹ç±»å‹
{: .prompt-info }

## å¸ƒå°”ç±»å‹
* å ä¸€ä¸ªå­—èŠ‚å¤§å°

## å­—ç¬¦ç±»å‹
* char ç±»å‹è¢«ç”¨æ¥æè¿°è¯­è¨€ä¸­æœ€åŸºç¡€çš„å•ä¸ªå­—ç¬¦
* å­—ç¬¦ç±»å‹çš„å­—é¢é‡ä½¿ç”¨å•å¼•å·
* å  4 ä¸ªå­—èŠ‚
* æ˜¯ Unicode æ ‡é‡å€¼


```rust
let emoj = 'ğŸ¥°';
```

## å¤åˆç±»å‹
* ä¸¤ç§å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆTupleï¼‰ã€æ•°ç»„

### Tuple 
* å¯ä»¥å°†å¤šä¸ªç±»å‹çš„å¤šä¸ªå€¼æ”¾åˆ°ä¸€ä¸ªç±»å‹é‡Œ
* å®ƒçš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä¸€æ—¦å£°æ˜å°±æ— æ³•æ”¹å˜
* Tuple é‡Œä¸ªæ¯ä¸ªä½ç½®éƒ½å¯¹åº”ä¸€ä¸ªç±»å‹ï¼Œå„å…ƒç´ ç±»å‹ä¸ç”¨ç›¸åŒ
* å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è§£æ„ Tuple æ¥è·å–å…ƒç´ çš„å€¼
* è®¿é—® Tuple å…ƒç´ ï¼Œä½¿ç”¨ç´¢å¼•


```rust
let tup: (i32, f64, u8) = (500, 6.4, 1);
let (x, y, z) = tup;
println!("{}, {}, {}, ", tup.0, tup.1, tup.2);
println!("{}, {}, {}, ", x, y, z);
```

### æ•°ç»„
* æ•°ç»„ä¹Ÿå¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
* æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒ
* æ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œä¸€æ—¦å£°æ˜å°±æ— æ³•æ”¹å˜
* æ•°ç»„æ²¡æœ‰ Vector çµæ´»ï¼ŒVector ç±»ä¼¼æ•°ç»„æ˜¯æ ‡å‡†åº“æä¾›çš„ï¼Œå®ƒçš„é•¿åº¦æ˜¯å¯å˜çš„
* æ•°ç»„çš„ç±»å‹ï¼Œä»¥ [ç±»å‹;é•¿åº¦] è¡¨ç¤º
* æ•°ç»„æ˜¯åœ¨ stack ä¸Šåˆ†é…çš„å•ä¸ªå—å†…å­˜
* å¦‚æœè®¿é—®ç´¢å¼•è¶Šç•Œäº†
1. ç¼–è¯‘ä¼šé€šè¿‡
2. è¿è¡Œæ—¶ä¼šæŠ¥é”™ panicï¼Œä¸ä¼šå…è®¸ç»§ç»­è®¿é—®ç›¸åº”çš„å†…å­˜åœ°å€

```rust
let list = [1,2,3,4,5];
let a: [i32;5] = [1,2,3,4,5];

let a = [3; 5]; // ç­‰äº [3,3,3,3,3]
println!("{}", a[0]);
```

# å‡½æ•°
* å£°æ˜å‡½æ•°æ—¶ä½¿ç”¨ fn å…³é”®å­—
* rust ä½¿ç”¨ snake case å‘½åè§„èŒƒ
1. æ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™ï¼Œå•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”

## å‡½æ•°å‚æ•°
1. parameters å½¢å‚
2. arguments å®å‚


> å‡½æ•°ç­¾åé‡Œå¿…é¡»å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹
{: .prompt-info }

* rust æ˜¯åŸºäºè¡¨è¾¾å¼çš„è¯­è¨€ï¼Œè¡¨è¾¾å¼ä¼šè®¡ç®—äº§ç”Ÿä¸€ä¸ªå€¼


> è¯­å¥è¿”å›ç©ºçš„ Tupleï¼Œ å³ ()
{: .prompt-info }


## å‡½æ•°çš„è¿”å›å€¼
* è¿”å›å€¼ä¸èƒ½å‘½å
* -> åæ˜¯è¿”å›å€¼ï¼Œéœ€è¦å£°æ˜è¿”å›å€¼çš„ç±»å‹
* å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯ä½¿ç”¨å‡½æ•°ä½“å†…æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºè¿”å›å€¼
* ä¹Ÿå¯ä½¿ç”¨ return + å€¼ï¼Œè¿”å›å€¼

```rust
fn another_function(x: i32) {
    println!("another function x is {}", x);

    let y = {
        x + 3  // x + 3 æ˜¯è¿™ä¸ªå—çš„è¿”å›å€¼
        //x + 3;   // åŠ äº† ; å°±å˜æˆè¯­å¥äº†ï¼Œè€Œè¯­å¥é»˜è®¤è¿”å› ç©º tuple å³ ()
    };
    println!("another function y is {}", y);

    println!("6 + 5 is {}", plus_five(6));

}

fn plus_five(x: i32) -> i32 {
    x + 5
}
```

> Noteï¼šä¸Šè¾¹æ³¨é‡Šä»£ç  `x + 3;`ï¼ŒåŠ äº† `;` å°±å˜æˆè¯­å¥äº†ï¼Œ`è€Œè¯­å¥é»˜è®¤è¿”å›ç©º tuple å³ ()`
{: .prompt-info }

# æ§åˆ¶æµ

## if
* if çš„æ¡ä»¶å¿…é¡»æ˜¯ bool ç±»å‹
* æ¡ä»¶åˆ†æ”¯å« arm
* å¦‚æœä½¿ç”¨äº†å¤šäºä¸€ä¸ª else ifï¼Œé‚£ä¹ˆæœ€å¥½æ›¿æ¢æˆ match
* if è¡¨è¾¾å¼å¯ä»¥ä½œä¸º let çš„å³é¡¹


```rust
let cond = true;
let number = if cond { 4 } else { 2 };
println!("number is {}", number);

// ç­‰äºè¿™æ ·
let number;
if cond {
    number = 4;
} else {
    number = 2;
}
```

## å¾ªç¯
* rust æä¾› 3 ç§å¾ªç¯ï¼šloopã€whileã€for

## loop
* å‘Šè¯‰ rust åå¤æ‰§è¡Œä¸€å—ä»£ç ï¼Œç›´åˆ°å–Šå®ƒåœ
* å¯ä»¥åœ¨ loop ä¸­ä½¿ç”¨ break è®©å®ƒåœæ­¢


```rust
let mut count = 0;
let result = loop {
    count += 1;

    if count == 10 {
        break count * 2;  // è¿”å› loop å—çš„ç»“æœç»™ result å˜é‡
    }
};

println!("result is {}", result);
```

* å¸¦æ ‡ç­¾çš„ loop


```rust
fn main() {
    println!("Hello, world!");

    let mut count = 0;
    'counting_up: loop {
        println!("count = {}", count);
        let mut remaining = 10;

        loop {
            println!("remaining = {}", remaining);
            if remaining == 9 {
                break;
            }
            if count == 2 {
                break 'counting_up;
            }
            remaining -= 1;
        }

        count += 1;
    }
    println!("End count = {}", count);

}
```


## while å¾ªç¯
* æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“ä¹‹å‰éƒ½åˆ¤æ–­ä¸€æ¬¡æ¡ä»¶

```rust
let mut number = 3;
while number != 0 {
    println!("{}", number);

    number -= 1;
}
```

## for å¾ªç¯
* å¸¸ç”¨çš„å¾ªç¯æ–¹å¼


```rust
let a = [10, 20, 30, 40, 50];
// item is &i32
for item in a.iter() {
  println!("the value is {}", item);
}
```

* Range ä¸ for å¾ªç¯
1. Range æŒ‡å®šä¸€ä¸ªå¼€å§‹æ•°å­—å’Œä¸€ä¸ªç»“æŸæ•°å­—ï¼Œ[start, end)
2. rev æ–¹æ³•å¯ä»¥åè½¬ Range

```rust
for num in (1..4).rev() { // (1..4) å°±æ˜¯ [1,4)
    println!("the num is {}", num);
}
```

